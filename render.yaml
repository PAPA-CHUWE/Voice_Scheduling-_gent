services:
  - type: web
    name: voice-scheduling-agent-api
    runtime: docker
    plan: starter
    region: frankfurt
    healthCheckPath: /api/v1/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000

      # ---- Required: Set these in Render dashboard as "Secret" values ----
      - key: MONGODB_URI
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false
      - key: GOOGLE_REFRESH_TOKEN
        sync: false

      # ---- Optional ----
      - key: GOOGLE_CALENDAR_ID
        value: primary
      - key: DEFAULT_TIMEZONE
        value: Africa/Harare

      # Auth (optional)
      - key: API_KEY
        sync: false
      - key: WEBHOOK_SECRET
        sync: false

      # Redis / reminders
      - key: REDIS_URL
        sync: false
      - key: REMINDERS_ENABLED
        value: "true"

      # Email (if you implemented it)
      - key: EMAIL_ENABLED
        value: "false"
      - key: EMAIL_FROM
        sync: false
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false

  - type: worker
    name: voice-scheduling-agent-worker
    runtime: docker
    plan: starter
    region: frankfurt
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000

      # Same secrets as API (worker needs DB + Redis + email)
      - key: MONGODB_URI
        sync: false
      - key: REDIS_URL
        sync: false

      - key: REMINDERS_ENABLED
        value: "true"

      # Email (if enabled)
      - key: EMAIL_ENABLED
        value: "false"
      - key: EMAIL_FROM
        sync: false
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false

    # For docker runtime, Render uses the Dockerfile CMD by default.
    # We override it to run the worker:
    dockerCommand: npm run worker
